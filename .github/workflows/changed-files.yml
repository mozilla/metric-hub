name: Get changed files

on:
  workflow_call:
    inputs:
      path_filter:
        type: string
        description: 'Path filter to look for changed files'
        required: false
        default: '**'
    outputs:
      any_changed:
        description: 'Did any file matching optional path filter change? [true|false]'
        value: ${{ jobs.changed.outputs.any_changed }}
      all_changed_files:
        description: 'List of changed files matching optional path filter'
        value: ${{ jobs.changed.outputs.all_changed_files }}

jobs:
  changed:
    runs-on: ubuntu-latest 
    name: Get changed files
    outputs:
      any_changed: ${{ steps.changed-files-specific.outputs.any_changed }}
      all_changed_files: ${{ steps.changed-files-specific.outputs.all_changed_files }}
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    - name: Get changed files
      id: changed-files-specific
      uses: tj-actions/changed-files@24d32ffd492484c1d75e0c0b894501ddb9d30d62
      with:
        files: ${{ inputs.path_filter }}
    - name: Print results
      env:
        PATH_FILTER: ${{ inputs.path_filter }}
        ANY_CHANGED: ${{ steps.changed-files-specific.outputs.any_changed }}
        ALL_CHANGED_FILES: ${{ steps.changed-files-specific.outputs.all_changed_files }}
      run: |
        echo "Using path filter: $PATH_FILTER"
        echo "Did files change?: $ANY_CHANGED"
        echo "All changed files: $ALL_CHANGED_FILES"
