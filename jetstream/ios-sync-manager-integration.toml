[metrics]

daily = ["rust_tab_sync_success", "bookmarks_sync_success", "logins_sync_success", "history_sync_success"]

weekly = ["rust_tab_sync_success", "bookmarks_sync_success", "logins_sync_success", "history_sync_success"]

overall = ["rust_tab_sync_success", "bookmarks_sync_success", "logins_sync_success", "history_sync_success"]

[metrics.rust_tab_sync_success]
select_expression = """COUNTIF(
            metrics.labeled_counter.rust_tabs_sync_failure_reason IS NULL 
            OR ARRAY_LENGTH(metrics.labeled_counter.rust_tabs_sync_failure_reason) = 0)/COUNT(*)"""
data_source = "rust_table"
friendly_name = "Rust tab sync success rate"
description = "Number of times that rust tabs sync successfully on ios divided by total syncs"

[metrics.bookmarks_sync_success]
select_expression = """COUNTIF(
            metrics.labeled_counter.bookmarks_sync_failure_reason IS NULL 
            OR ARRAY_LENGTH(metrics.labeled_counter.bookmarks_sync_failure_reason) = 0)/COUNT(*)"""
data_source = "bookmark_table"
friendly_name = "Bookmarks sync success rate"
description = "Number of times that bookmarks sync successfully on ios divided by total syncs"

[metrics.logins_sync_success]
select_expression = """COUNTIF(
            metrics.labeled_counter.logins_sync_failure_reason IS NULL 
            OR ARRAY_LENGTH(metrics.labeled_counter.logins_sync_failure_reason) = 0
        )/COUNT(*)"""
data_source = "login_table"
friendly_name = "Login sync success rate"
description = "Number of times that logins successfully sync on ios divided by total syncs"

[metrics.history_sync_success]
select_expression = """COUNTIF(
            metrics.labeled_counter.history_sync_failure_reason IS NULL 
            OR ARRAY_LENGTH(metrics.labeled_counter.history_sync_failure_reason) = 0)/COUNT(*) AS count_total"""
data_source = "history_table"
friendly_name = "History sync success rate"
description = "Number of times that history is successfully synced on ios divided by total syncs"

[metrics.rust_tab_sync_success.statistics.bootstrap_mean]
[metrics.bookmarks_sync_success.statistics.bootstrap_mean]
[metrics.logins_sync_success.statistics.bootstrap_mean]
[metrics.history_sync_success.statistics.bootstrap_mean]

[data_sources]

[data_sources.rust_table]
from_expression = "org_mozilla_ios_firefox.temp_rust_tabs_sync"

[data_sources.bookmark_table]
from_expression = "org_mozilla_ios_firefox.temp_bookmarks_sync"

[data_sources.login_table]
from_expression = "org_mozilla_ios_firefox.temp_logins_sync"

[data_sources.history_table]
from_expression = "org_mozilla_ios_firefox.temp_history_sync"
