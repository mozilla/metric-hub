[experiment]

[experiment.exposure_signal]
name = "contextual_reach"
friendly_name = "Context-appropriate trigger for callout"
description = "Clients eligible to receive contextual callout"
data_source = "contextual_message"
select_expression = "COALESCE(exposure, FALSE)"
window_start = 0
window_end = "analysis_window_end"

[data_sources.contextual_message]
from_expression = """(
  SELECT
    CAST(submission_timestamp as DATE) as submission_date,
    legacy_telemetry_client_id as client_id,
    TRUE as exposure
  FROM `mozdata.firefox_desktop.events_stream`
  WHERE
    event = 'messaging_experiments.reach_fxms_message_14'
    AND DATE(submission_timestamp) >= '2025-04-29'
    AND JSON_VALUE(experiments.`vertical-tabs-feature-callout`.branch) IS NOT NULL
    AND JSON_VALUE(event_extra.value) = 'vertical-tabs-feature-callout'
  GROUP BY ALL
)"""
experiments_column_type = "none"
friendly_name = "Contextual Suggestion"
description = "Clients eligible to receive contextual callout"
